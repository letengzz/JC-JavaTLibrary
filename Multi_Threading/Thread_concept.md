# 线程的相关概念

## 程序

程序(program)是为完成特定任务、用某种语言编写的一组指令的集合。即指一段静态的代码，静态对象。 我们都知道计算机的核心是CPU，它承担了所有的计算任务，而操作系统是计算机的管理者，它负责任务的调度，资源的分配和管理，统领整个计算机硬件；应用程序是具有某种功能的程序，程序是运行于操作系统 之上的。

## 线程

在早期的操作系统中并没有线程的概念，进程是拥有资源和独立运行的最小单位，也是程序执行的最小单位。任务调度采用的是时间片轮转的抢占式调度方式，而进程是任务调度的最小单位，每个进程有各自独立的 一块内存，使得各个进程之间内存地址相互隔离。 后来，随着计算机的发展，对CPU的要求越来越高，进程之间的切换开销较大，已经无法满足越来越复杂 的程序的要求了。于是就发明了线程，**线程是程序执行中一个单一的顺序控制流程，是程序执行流的最小单元，是处理器调度和分派的基本单位**。 

现代操作系统（Windows，macOS，Linux）都可以执行多任务。多任务就是同时运行多个任务。

CPU执行代码都是一条一条顺序执行的，但是，即使是单核CPU，也可以同时运行多个任务。因为操作系统执行多任务实际上就是让CPU对多个任务轮流交替执行。类似的，操作系统轮流让多个任务交替执行，例如，让浏览器执行0.001秒，让QQ执行0.001秒，再让音乐播放器执行0.001秒，在人看来，CPU就是在同时执行多个任务。

即使是多核CPU，因为通常任务的数量远远多于CPU的核数，所以任务也是交替执行的。

**线程**(thread)，进程可进一步细化为线程，是一个程序内部的一条执行路径。 若一个进程同一时间并行执行多个线程，就是支持多线程的（360）。 线程作为调度和执行的单位，每个线程拥有独立的运行栈和程序计数器(pc)，线程切换的开销小。 一个进程中的多个线程共享相同的内存单元/内存地址空间 -> 它们从同一堆中分配对象，可以访 问相同的变量和对象。这就使得线程间通信更简便、高效。但多个线程操作共享的系统资源可能就会带来安全的隐患。 

简而言之：**线程是进程的一个执行单元。比进程更小的独立运行的基本单位**。 

**注意**：一个程序至少一个进程，一个进程至少一个线程。比如视频中同时有声音、图像、弹幕等。

**Java语言内置了多线程支持**：一个Java程序实际上是一个JVM进程，JVM进程用一个主线程来执行`main()`方法，在`main()`方法内部，我们又可以启动多个线程。此外，JVM还有负责垃圾回收的其他工作线程等。

因此，对于大多数Java程序来说，我们说多任务，实际上是说如何使用多线程实现多任务。

和单线程相比，多线程编程的**特点**：**多线程经常需要读写共享数据，并且需要同步**。例如，播放电影时，就必须由一个线程播放视频，另一个线程播放音频，两个线程需要协调运行，否则画面和声音就不同步。因此，多线程编程的复杂度高，调试更困难。

Java多线程编程的**特点**：

- 多线程模型是Java程序最基本的并发模型
- 后续读写网络、数据库、Web开发等都依赖Java多线程模型

![image-20221103203513424](https://cdn.jsdelivr.net/gh/letengzz/Two-C@mian/img/Java/202211041948286.png)

## 进程

在计算机中，我们把一个任务称为一个进程，浏览器就是一个进程，视频播放器是另一个进程，类似的，音乐播放器和Word都是进程。

某些进程内部还需要同时执行多个子任务。例如，我们在使用Word时，Word可以让我们一边打字，一边进行拼写检查，同时还可以在后台进行打印，我们把子任务称为**线程**。

**进程(process)是程序的一次执行过程，或是一个正在执行的程序**。

进程是一个动态的过程：**有它自身的产 生、存在和消亡的过程**。 如：运行中的QQ，运行中的音乐播放器、视频播放器等； 程序是静态的，进程是动态的； 进程作为资源分配的单位，系统在运行时会为每个进程分配不同的内存区域； **进程是一个具有一定独立功能的应用程序在一个数据集上的一次动态执行的过程**，是操作系统进行资源分配和调度的一个独立单位，是应用程序运行的载体。**进程是一种抽象的概念，从来没有统一的标准定义**。 进程一般**由程序，数据集合和进程控制块三部分组成**。 程序用于描述进程要完成的功能，是控制进程执行的指令集； 数据集合是程序在执行时所需要的数据和工作区； 程序控制块包含进程的描述信息和控制信息是进程存在的唯一标志。 

**进程特征**：

- **动态性**：进程是程序的一次执行过程，是临时的，有生命期的，是动态产生，动态消亡的

- **并发性**：任何进程都可以同其他进程一起并发执行； 独立性：进程是系统进行资源分配和调度的一个独立单位，不同进程的工作互相不影响

- **结构性**：进程由程序，数据和进程控制块三部分组成； 制约性：因访问共享数据/资源或进程间同步而产生制约； 简而言之: 进程是一个应用程序的运行实例，是一个动态概念，竞争计算机系统资源的基本单位。在操作系统中运行的程序就是进程，比如：QQ、游戏、IDEA、钉钉等

**进程与程序联系与区别**：

-  **两者联系**：

  - 进程是操作系统处于执行状态程序的抽象 ：

    - 程序 = 文件（静态的可执行文件） 

    - 进程 = 执行中的程序 = 程序 + 执行状态

  - 同一个程序的多次执行过程对应为不同进程 。例如：多次使用命令ls的执行对应多个进程。 

  - 进程执行需要的资源 ：

    - 内存：保存代码和数据 

    - cpu：执行指令

-  **两者区别**：

  - 进程是动态的，程序是静态的。

    - 程序是有序代码的集合

    - 进程是程序的执行 

  - 进程是暂时的，程序是永久的。

    - 进程时一个状态变化的过程 

    - 程序可长久保存 

  - 进程与程序的组成不同。 

    - 进程的组成包括程序，数据，和进程控制块。 

简单来说：我们写好的一个代码，要想让它运行起来，首先需要将这个程序加载到内存中，程序一旦运行 那么就是一个进程，就需要给进程分配资源建立PCB等动作。说白了，程序只是一个存储在我们硬盘上的文件 而已断电不会消失，但是进程是在动态运行的一个实体，进程执行结束相关信息就会被释放了。

**进程和线程的关系**：

一个进程可以包含一个或多个线程，但至少会有一个线程。

![image-20221103203905069](https://cdn.jsdelivr.net/gh/letengzz/Two-C@mian/img/Java/202211041949770.png)



操作系统调度的最小任务单位其实不是进程，而是线程。常用的Windows、Linux等操作系统都采用抢占式多任务，如何调度线程完全由操作系统决定，程序自己不能决定什么时候执行，以及执行多长时间。

因为同一个应用程序，既可以有多个进程，也可以有多个线程，因此，实现多任务的方法，有以下几种：

**多进程模式(每个进程只有一个线程)**：

![image-20221103204108738](https://cdn.jsdelivr.net/gh/letengzz/Two-C@mian/img/Java/202211041949977.png)

**多线程模式(一个进程有多个线程)**：

![image-20221103204116516](https://cdn.jsdelivr.net/gh/letengzz/Two-C@mian/img/Java/202211041950732.png)

**多进程＋多线程模式(复杂度最高)**：

![image-20221103204125698](https://cdn.jsdelivr.net/gh/letengzz/Two-C@mian/img/Java/202211041950903.png)

**进程 vs 线程**：

进程和线程是包含关系，但是多任务既可以由多进程实现，也可以由单进程内的多线程实现，还可以混合多进程＋多线程。

具体采用哪种方式，要考虑到进程和线程的特点。

------

和多线程相比，多进程的缺点：

- 创建进程比创建线程开销大，尤其是在Windows系统上；
- 进程间通信比线程间通信要慢，因为线程间通信就是读写同一个变量，速度很快。

多进程的优点在于：

- 多进程稳定性比多线程高，因为在多进程的情况下，一个进程崩溃不会影响其他进程，而在多线程的情况下，任何一个线程崩溃会直接导致整个进程崩溃。